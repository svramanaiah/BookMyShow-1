{% extends "users/basic.html" %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-lg-8 mx-auto">
      
      <!-- Movie and Theater Info -->
      <div class="card mb-4 shadow-sm">
        <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
          <div>
            <h4 class="card-title mb-1">{{ theaters.movie.name }}</h4>
            <p class="card-text text-muted mb-0">{{ theaters.name }} | {{ theaters.time }}</p>
          </div>
          <div>
            <img src="{{ theaters.movie.image.url }}" 
                 alt="{{ theaters.movie.name }}" 
                 class="img-fluid rounded" 
                 style="width: 100px; height: auto;">
          </div>
        </div>
      </div>

      <!-- Seat Selection -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title text-center mb-4">Select Your Seats</h5>
          <div class="screen">All eyes this way please!</div>

          <form method="POST">
            {% csrf_token %}

            <!-- Seats Grid -->
            <div class="d-flex justify-content-center flex-wrap mb-4">
              {% for seat in seats %}
              <div class="seat {% if seat.is_booked %}sold{% endif %}">
                {% if not seat.is_booked %}
                  <input type="checkbox" name="seats" value="{{ seat.id }}" class="d-none" id="seat-{{ seat.id }}">
                  <label for="seat-{{ seat.id }}" class="w-100 h-100 d-flex align-items-center justify-content-center">
                    {{ seat.seat_number }}
                  </label>
                {% else %}
                  <span class="d-flex align-items-center justify-content-center h-100 w-100">
                    {{ seat.seat_number }}
                  </span>
                {% endif %}
              </div>
              {% endfor %}
            </div>

            <!-- Seat Legend -->
            <div class="d-flex justify-content-center mb-4 flex-wrap">
              <div class="d-flex align-items-center me-4 mb-2">
                <div class="seat" style="background-color: #ccc;"></div>
                <span class="ms-2">Available</span>
              </div>
              <div class="d-flex align-items-center me-4 mb-2">
                <div class="seat selected"></div>
                <span class="ms-2">Selected</span>
              </div>
              <div class="d-flex align-items-center mb-2">
                <div class="seat sold"></div>
                <span class="ms-2">Sold</span>
              </div>
            </div>

            <!-- Book Button -->
            <div class="text-center">
              <button type="submit" class="btn btn-success btn-lg px-4">
                Book Selected Seats
              </button>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
  .screen {
    background-color: grey;
    color: white;
    padding: 10px;
    text-align: center;
    font-weight: bold;
    margin-bottom: 20px;
    border-radius: 5px;
  }

  .seat {
    width: 40px;
    height: 40px;
    background-color: #ccc;
    border-radius: 5px;
    margin: 5px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 500;
    transition: background-color 0.2s ease;
  }

  .seat label {
    width: 100%;
    height: 100%;
    margin: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
  }

  .seat.selected {
    background-color: #28a745 !important;
    color: white;
  }

  .seat.sold {
    background-color: #dc3545 !important;
    color: white;
    cursor: not-allowed;
  }

  .seat input[type="checkbox"]:checked + label {
    background-color: #28a745;
    color: white;
    border-radius: 5px;
  }

  .seat input[type="checkbox"]:checked + label:hover {
    background-color: #218838;
  }

  .seat label:hover {
    background-color: #ddd;
    border-radius: 5px;
  }
</style>
{% endblock %}

{% block scripts %}
<script>
  document.querySelectorAll('.seat input[type="checkbox"]').forEach(function (checkbox) {
    checkbox.addEventListener('change', function () {
      const seatBox = checkbox.closest('.seat');
      if (checkbox.checked) {
        seatBox.classList.add('selected');
      } else {
        seatBox.classList.remove('selected');
      }
    });
  });
</script>
{% endblock %}
